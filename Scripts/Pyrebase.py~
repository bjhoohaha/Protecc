try:
    # import mysql module
    import pyrebase
except:
    # print except if module is not found
    print("Module pyrebase not found. Run 'pip install pyrebase'")
import sys
import shutil
import os
import datetime
import subprocess

config = {
  "apiKey": 'AIzaSyBErUYGNUmFcbEg-nGY_HOO0tu2KcO0AUY',
  "authDomain": 'employee-manager-66213.firebaseapp.com',
  "databaseURL": 'https://employee-manager-66213.firebaseio.com',
  "projectId": 'employee-manager-66213',
  "storageBucket": 'employee-manager-66213.appspot.com',
  "messagingSenderId": '909669458330',
  "appId": '1:909669458330:web:5e65236fc44dcb75'
  # "serviceAccount": 'path/to/serviceAccountKey.json'
}

class FireBaseInit:
    __db=''
    __user=''


    def __init__(self, email, password):
        #setup database
        firebase = pyrebase.initialize_app(config)
        self.db = firebase.database()
        auth = firebase.auth()
        #authenticate
        self.user = auth.sign_in_with_email_and_password(email, password)

    def getUserIDToken(self):
        return self.user['idToken']

    def addPacket(self, source_ip, destination_ip, protocol, length, info) :
        data = {
            "created_at": '{:%Y-%m-%d %H:%M:%S}'.format(datetime.datetime.now()),
            "updated_at": '{:%Y-%m-%d %H:%M:%S}'.format(datetime.datetime.now()),
            "source_ip": source_ip,
            "destination_ip": destination_ip,
            "protocol": protocol,
            "length": length,
            "info": info
        }
        self.db.child('packets').push(data, self.getUserIDToken())

    def describeDatabase(self):
        for i in self.db.child('packets').get(self.getUserIDToken()).each():
            print("%s : %s" % (i.key(), i.val()))

# db = firebase.database()
# auth = firebase.auth()
#
# user = auth.sign_in_with_email_and_password("ong_bingjue@hotmail.com", "adminadminadmin")
fb = FireBaseInit("ong_bingjue@hotmail.com", "adminadminadmin")
# fb.addPacket('192.168.1.113', '8.8.8.8', 'TCP', 60, 'Application Data')
fb.describeDatabase()
# data = {
#     "created_at": '{:%Y-%m-%d %H:%M:%S}'.format(datetime.datetime.now()),
#     "updated_at": '{:%Y-%m-%d %H:%M:%S}'.format(datetime.datetime.now()),
#     "source_ip": "192.168.1.113",
#     "destination_ip": "8.8.8.8",
#     "protocol": "TCP",
#     "length": 60,
#     "info": "Application Data"
# }
# print(db.get(user['idToken']).val())
# db.child('packets').push(data, user['idToken'])
# print(db.get(user['idToken']).val())
